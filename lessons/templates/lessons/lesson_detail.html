{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}{{ lesson.title }} ‚Äî –£—Ä–æ–∫{% endblock %}

{% block content %}
<section class="panel" aria-label="–î–µ—Ç–∞–ª—ñ —É—Ä–æ–∫—É" style="padding:1.5rem">

{% if lesson.parent_notes %}
  <section class="panel" style="background:#fef6fb;padding:1rem;margin-top:1rem">
    <h3>üë®‚Äçüë©‚Äçüëß –î–ª—è –±–∞—Ç—å–∫—ñ–≤ —ñ –ø–µ–¥–∞–≥–æ–≥—ñ–≤</h3>
    <p>{{ lesson.parent_notes|linebreaks }}</p>
  </section>
{% endif %}

  <!-- –í—ñ—Ç–∞–ª—å–Ω–∏–π –±–ª–æ–∫ –∑ –∞—Å–∏—Å—Ç–µ–Ω—Ç–æ–º -->
  <div style="display:flex;gap:1.5rem;align-items:center;flex-wrap:wrap">
    <div style="padding:.5rem;background:#fff;border-radius:20px;border:2px dashed #e5e7eb;box-shadow:0 8px 24px rgba(0,0,0,0.08)">
      <img src="{% static lesson.assistant_image %}" alt="–ê—Å–∏—Å—Ç–µ–Ω—Ç —É—Ä–æ–∫—É" style="height:160px;border-radius:14px;">
    </div>
    <div>
      <h1 style="margin:.2rem 0 0;font-size:1.8rem">{{ lesson.emoji|default:"üìò" }} {{ lesson.title }}</h1>
      <p class="muted" style="margin:.5rem 0 0;font-size:1.1rem">
        –ü—Ä–∏–≤—ñ—Ç! –î–∞–≤–∞–π –¥—ñ–∑–Ω–∞—î–º–æ—Å—å —â–æ—Å—å –Ω–æ–≤–µ–Ω—å–∫–µ —Ä–∞–∑–æ–º —ñ–∑ –Ω–∞—à–∏–º –ø–æ–º—ñ—á–Ω–∏–∫–æ–º!
      </p>
    </div>
  </div>

  <!-- –ü—Ä–æ —É—Ä–æ–∫ -->
  {% if lesson.summary %}
    <section class="panel" style="background:#fffbea;padding:1rem;border-radius:12px;margin-top:1.5rem">
      <h2 style="margin-top:0">üìù –ü—Ä–æ —É—Ä–æ–∫</h2>
      <p>{{ lesson.summary|linebreaks }}</p>
    </section>
  {% endif %}

  <!-- –ë–µ–π–¥–∂—ñ -->
  <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin:1rem 0">
    {% if lesson.level %}
      <span style="font-size:.9rem;padding:.3rem .7rem;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc">‚≠ê –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: {{ lesson.level }}</span>
    {% endif %}
    {% if lesson.duration %}
      <span style="font-size:.9rem;padding:.3rem .7rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff7ed">‚è±Ô∏è {{ lesson.duration }} —Ö–≤</span>
    {% endif %}
    {% if lesson.age_range %}
      <span style="font-size:.9rem;padding:.3rem .7rem;border-radius:999px;border:1px solid #e5e7eb;background:#ecfeff">üëß –í—ñ–∫: {{ lesson.age_range }}</span>
    {% endif %}
  </div>

  <!-- –¢–µ–æ—Ä—ñ—è -->
  {% if lesson.theory %}
    <section class="panel" style="margin-top:1rem;padding:1rem;background:#eef2ff;border-color:#c7d2fe">
      <h3 style="margin-top:0">üìö –¢–µ–æ—Ä—ñ—è</h3>
      <div style="margin-top:.5rem;line-height:1.65">
        {{ lesson.theory|linebreaks }}
      </div>
    </section>
  {% endif %}

  <!-- –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ -->
 {% if materials_list %}
   <section class="panel" style="margin-top:1rem;padding:1rem;background:#f0fdf4;border-color:#dcfce7">
    <h3 style="margin-top:0">üß∞ –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h3>
    <ul style="margin:.5rem 0 0; padding-left: 1.2rem; line-height: 1.6">
      {% for item in materials_list %}
        <li>{{ item }}</li>
      {% endfor %}
    </ul>
  </section>
{% endif %}
<!-- –ö—Ä–æ–∫–∏ -->
{% if steps_list %}
  <section class="panel" style="margin-top:1rem;padding:1rem;background:#eff6ff;border-color:#dbeafe">
    <h3 style="margin-top:0">ü™ú –ö—Ä–æ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</h3>
    <ul style="margin:.5rem 0 0; padding-left: 1.2rem; line-height: 1.6">
      {% for step in steps_list %}
        <li>{{ step }}</li>
      {% endfor %}
    </ul>
  </section>
{% endif %}


  <!-- –í–ø—Ä–∞–≤–∏ -->
  {% if exercises %}
    <section class="panel" style="margin-top:1rem;padding:1rem">
      <h3 style="margin-top:0">‚öóÔ∏è –í–ø—Ä–∞–≤–∏</h3>
      <ol style="margin:.5rem 0 0;padding-left:1.25rem">
        {% for ex in exercises %}
          <li style="margin:.25rem 0">
            <strong>{{ ex.title }}</strong>
            {% if ex.instructions %}
              <div class="muted" style="margin:.2rem 0 0">{{ ex.instructions|truncatewords:26 }}</div>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </section>
  {% endif %}

  <!-- –ù–æ—Ç–∞—Ç–∫–∞ –∑ –±–µ–∑–ø–µ–∫–∏ -->
  {% if lesson.safety_note %}
    <section class="panel" style="margin-top:1rem;padding:1rem;background:#fff7ed;border-color:#ffedd5">
      <h3 style="margin-top:0">ü´∂ –ù–æ—Ç–∞—Ç–∫–∞ –∑ –±–µ–∑–ø–µ–∫–∏</h3>
      <p style="margin:.5rem 0 0">{{ lesson.safety_note|linebreaks }}</p>
    </section>
  {% endif %}

  <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
  <div style="display:flex;gap:.75rem;flex-wrap:wrap;margin-top:1.5rem">
    <a class="btn" href="{% url 'lessons' %}">‚¨Ö –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —É—Ä–æ–∫—ñ–≤</a>
    <a class="app-btn" href="{% url 'experiments:experiments' %}">üî¨ –î–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤</a>

    {% if lesson.slug %}
      <a class="app-btn" href="{% url 'lesson_exercise_list' lesson.slug %}">üß© –£—Å—ñ –≤–ø—Ä–∞–≤–∏</a>
    {% else %}
      <span class="muted" title="–£—Ä–æ–∫ –±–µ–∑ slug">‚õî –£—Ä–æ–∫ –±–µ–∑ –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–ø—Ä–∞–≤</span>
    {% endif %}
  </div>

</section>
{% endblock %}
